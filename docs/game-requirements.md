# Vampire Dungeon - ゲーム要件定義書

## 基本ゲームプレイ

### 操作方法

- 移動: 右クリックで指定位置へ移動（League of Legends形式）
- スキル: Q, W, E, Rキーで発動
- カメラ: プレイヤーキャラクターに固定
- デバッグ: Vキーで敵の視認範囲表示切り替え

### ダンジョン構造

- 2階層のダンジョン + ボス戦で構成
- 各階層には固有の特性（壁の色、障害物の数など）が設定される
- 各階層にはタイマーが設定される
- 各階層クリア後、報酬選択ステージに移行（報酬選択めんどいのでとりあえずなし）
- 壁や障害物は貫通不可能（衝突判定あり）

### 報酬選択ステージ

以下の3つからランダムに選択肢が提示され、1つを選択可能：

1. 体力80回復
2. ショップへの移動
3. ランダムイベント
   - コスト: 100G
   - 効果: QスキルとWスキルを合成して新しいQスキルを作成

## スキルシステム

### 初期状態

- ゲーム開始時、QスキルにアーリのQスキルが固定で付与

### スキル獲得と管理

- ダンジョン内の箱を破壊してスキルアイテムを入手可能
- スキルアイテム取得時、3つのランダムスキルから1つを選択
- 選択したスキルはQ、W、E、Rキーのいずれかに割り当て可能
- 既にスキルが割り当てられているキーには新規スキルを割り当て不可
- 同じスキルを再取得した場合、そのスキルを強化可能

### スキル使用

- スキル使用にはマナが必要
- マナは時間経過で自動回復
- スキルは指定方向に発動

## スキル

- マジックオーブ
  - キーを押したとき、カーソル方向に魔法の玉を射出する。往路、復路でダメージを与える
  - 距離10メートル
  - 威力:10(往路10,復路10)
  - クールダウン:6秒
  - マナコスト:15
- ダッシュ斬り:キーを押したとき、即座にカーソル方向にダッシュして斬撃

  - 距離:15メートル
  - 威力:15
  - 障害物（敵、壁など）が途中にある場合は移動はそこまで
  - この攻撃で敵にトドメを刺した場合、即座にクールダウン解消。墓石を破壊した場合クールダウン4.5s解消
  - クールダウン:7秒
  - マナコスト:20

- サイドウェイブ
  - キーを押したとき、現在の自身の正面方向とは垂直の両サイドに強力な攻撃を放つ
  - 各7メートル
- デジャヴ:直前に使用したスキルを再度使用。クールタイム長め
- エレクトリックパレード:自身の周囲を回る玉を三つ発生させる。5秒で消える。敵に触れると消滅しダメージとスローを与える。かつ、プレイヤーは5秒間移動速度上昇。
- 星の呼び声:カーソル地点に円状の魔法攻撃を行う。この攻撃で敵にとどめを刺した場合、体力を5回復。
  - 10メートル
- 硬化: 1秒間、歩行不能になり無敵になる。
  - スキルは使用可能
- 変幻自在の剣
  - 一度スキルを使用したら3秒以内に再発動可能。
  - 自身の進行方向正面60°の範囲にカーソルがある場合パターン1。それ以外の角度ではパターン2
  - パターン1：
    - 伸びるような弧を描く斬撃
    - 斜め15°の位置で敵にヒットさせたらクリティカル1.5倍ダメージ。
  - パターン2:
    - 横幅の広い範囲攻撃の斬撃
- 人造犬: 設置型。近寄った敵に突撃して爆発する
  - 遠距離攻撃をこの犬で受けて消滅させることができる

## キャラクター管理

### 体力システム

- 体力は時間経過では回復しない
- 回復手段:
  - 報酬選択での全回復
  - アイテムによる回復（詳細未定）

### マナシステム

- スキル使用の消費リソース
- 時間経過で自動回復

### 経験値システム

- 敵を倒すと経験値を獲得するが、現在ステータス上昇は行われない

### 状態異常システム

- 一部の攻撃はスローなどの状態異常を付与
- 状態異常は時間経過で解消
- 重ね掛け可能（スローが重複した分だけ移動速度が低下）
- 状態異常が3つ重なるとスタン状態となり、あらゆる行動が一定時間不能

## アイテムシステム

### 箱のドロップアイテム

- ランダムアイテム
- スキル獲得アイテム
  - 提示された3つのスキルからひとつを選択
- スキルアップグレード
  - 指定したスキルを強化
- その他アイテム
  - ブーツ:移動速度上昇
  - お守り:一度死んでも再度体力満タンで復活
  - モンスターが入ってることもあり

## 敵システム

### 敵の生成

- 各階層ごとに固定数の敵が出現
  - プレイヤーから見えない範囲で再度湧く

### 敵の特性

- 階層によって敵の特性は変化しない
- 敵の体力や攻撃力などのステータスは固定値

### 衝突判定

- プレイヤーと敵は壁や障害物を貫通できない
- 衝突時は元の位置に戻る

### 視線判定

- 敵は一定範囲（10単位）内にプレイヤーがいる場合のみ検知可能
- 壁や障害物が敵とプレイヤーの間にある場合、プレイヤーを検知できない
- 視覚的な判断材料として、Vキーで視認範囲を表示できる
  - 赤色: プレイヤーを検知している状態
  - 黄色: プレイヤーを検知していない状態

### 敵キャラクター

- ジェリー・スライム

  - 挙動：
    - プレイヤーに向かってゆっくり跳ねてくる（直線的で予測しやすい）。
    - 近づくと飛び跳ねて、プレイヤーのいた位置に着地して範囲攻撃。プレイヤーは落下地点から離れることができれば避けることが可能
  - 特徴:
    - 倒すと1回だけ2体に分裂（最大でも2段階で終了）。
    - HP:20（Qの往路か復路1発で倒せる）。
  - 戦略：
    - Ｑの復路で増えたジェリーも同時に倒し切れる
  - Three.jsポイント:
    - 跳ねる動きはMath.sin()で上下アニメ。
    - 分裂時にscaleを半分にしてclone()で2体生成、軽いパーティクルで「分裂感」を演出。

- アーチャー・ウィスプ (Archer Wisp)

  - 見た目：
    - 小さな浮遊する炎の精霊、弓を構えた姿。赤と黄色の炎が揺らめき、PointLightで周囲を微照。
  - 挙動：
    - プレイヤーから距離を取って（5～7m）浮遊。
    - 遠距離攻撃：炎の矢を2秒ごとに発射（直線軌道、速度3m/s）。
  - 攻撃特徴：
    - 炎の矢はプレイヤーか他の敵に当たるとダメージ（Qの1/3くらい）。
  - Three.jsポイント：
    - 矢はCylinderGeometryにParticleSystemで炎の軌跡。

- 寂れた騎士（rustyknihgt）

  - プレイヤーが近づいたとき、突き攻撃を放つ。攻撃前に攻撃範囲が表示される。プレイヤーの進行方向に突きを繰り出すので、プレイヤーは攻撃範囲を見たらバックして避ける。
  - 良く部屋の出入り口に湧き、入室と同時に攻撃を放つ
  - 攻撃範囲10メートル

- 中堅魔導士

  - 直進する雷球を放つ。15ダメージと状態異常スタンを与える。

- 王宮魔導士
  　- プレイヤーを視認したら10s詠唱に入る
  　- 詠唱完了後、強力で高速な魔法をプレイヤーに向かって放つ。壁は貫通する。（lolのエズリアルのult）

- バンパイアゴースト
  - 高速で移動する
  - プレイヤーとの距離が9メートルになった場合、プレイヤーを中心に時計回りに70度回転した位置に瞬間移動してプレイヤーに向かって棒状の範囲攻撃

- 鋼鉄の騎士団長

  - 全てのダメージを1ずつしかくらわない
  - HP10
  - フロア1の階段に湧く

- 赤の龍
- 見た目：巨大な赤い火の竜
- 攻撃特徴:
  - 視界外からでもプレイヤーを追尾する炎の玉を発射
  - 炎の玉は人造犬で受けれる

#### ボス

- 黒の魔導士
  - 弾幕を大量に張るので、それを避けて攻撃を与える
  - 弾幕パターン1:水平方向に等間隔の玉が右から左に移動しながら全体的に上に上昇、垂直方向も似た動きだが上から下に緩急が付く
    　- 弾幕パターン2:敵が手を挙げると敵の周囲に玉発生、回転しながら広がりまた戻ってくる

### マップギミック

- 墓石ブロック
  　- 攻撃することで破壊可能
  　- ドラゴンの炎を受けると炎消え、墓石破壊
- 崩落ブロック (Crumbling Block)
  - 見た目：
    - ひび割れた石の壁や床（高さ2m、幅1mくらい）。BoxGeometryにクラックテクスチャで脆そうな雰囲気。
    - 崩れると瓦礫が散らばり、PlaneGeometryで薄暗いスローエリア（半径2mくらい）を生成。
  - 挙動：
    - プレイヤーもしくは敵の攻撃がヒットすると即座に崩落。
  - 効果：
    - 崩落に巻き込む：
      - 範囲内の敵（半径1m）にダメージ（Qの半分くらい）。
      - 巻き込んだ敵を0.5秒スタン（動き完全停止）。
    - スロー足場：
      - 崩落後に地面にスローエリア生成（半径2m、持続3秒）。
      - エリア内のキャラ（プレイヤー含む）の移動速度を50%減。
      - 確定10ダメージ（確定ダメージは、鋼鉄の騎士にもダメージ通る）
  - Three.jsポイント：
    - 崩落アニメはTWEEN.jsでブロックを落下、Physics（Cannon.js）で瓦礫を散らす。
    - スローエリアはPlaneGeometryにShaderMaterialで薄い霧エフェクト、境界にパルスアニメ。

## 今後の検討事項

- 各階層の具体的な時間制限
- スキルの詳細な仕様（ダメージ、効果、マナコストなど）
- ショップでの商品内容
- その他のドロップアイテムの種類と効果
- ボス戦の具体的な内容
- パスファインディングAIの実装（敵が壁を迂回するロジック）
